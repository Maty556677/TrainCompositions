function deleteAllCookies(){document.cookie.split(";").forEach((e=>{const t=e.indexOf("="),n=t>-1?e.substring(0,t):e;document.cookie=n+"=;expires=Thu, 01 Jan 1970 00:00:00 GMT"}))}document.addEventListener("DOMContentLoaded",(()=>{const e=document.getElementById("trainSearch"),t=document.getElementById("searchBtn"),n=document.getElementById("results"),o=document.getElementById("serverSelect"),r=document.getElementById("toggleDarkMode"),s=document.getElementById("popup"),c=document.getElementById("acceptCookies"),a=document.getElementById("homeBtn"),i=document.getElementById("headerText"),l=document.getElementById("miniHeader"),d=document.getElementById("miniTrainSearch"),u=document.getElementById("miniSearchBtn"),m=document.getElementById("miniBackBtn");function E(e){a.classList.toggle("hidden",!e)}function p(){const t=y();if(!t.length)return;const r=document.getElementById("lastSearchesList");r&&r.remove();const s=document.createElement("div");s.id="lastSearchesList",s.style.marginTop="2rem";const c=document.createElement("h3");c.textContent="[historySection]",s.appendChild(c),t.forEach((t=>{const n=document.createElement("button"),r=/[A-Z]/.test(t)&&/[A-Z]/i.test(t.replace(/[0-9\s\-+,]/g,""));n.textContent=r?`"${t}"`:t,n.style.marginRight="0.5rem",n.addEventListener("click",(()=>{e.value=t,o.value&&k(!0)})),s.appendChild(n)})),n.appendChild(s)}window.addEventListener("scroll",(()=>{const e=window.scrollY;if(e<=150)l.style.transform="translateX(-50%) translateY(-100%)",l.classList.add("hidden");else if(l.classList.remove("hidden"),e>=500)l.style.transform="translateX(-50%) translateY(0)";else{const t=100*((e-150)/350)-100;l.style.transform=`translateX(-50%) translateY(${t}%)`}})),e.addEventListener("input",(()=>{d.value=e.value})),d.addEventListener("input",(()=>{e.value=d.value})),u.addEventListener("click",(()=>{k(!1)})),t.addEventListener("click",(()=>{k(!1)})),d.addEventListener("keydown",(e=>{"Enter"===e.key&&k(!1)})),m.addEventListener("click",(()=>{document.querySelectorAll(".train-card").forEach((e=>e.remove())),g(),e.value="",d.value="",p(),E(!1),window.scrollTo({top:0,behavior:"smooth"})})),E(!1),t.addEventListener("click",(()=>k(!1))),e.addEventListener("keydown",(e=>{"Enter"===e.key&&k(!1)}));const h=p;p=function(){h(),document.querySelectorAll("#lastSearchesList button").forEach((e=>{e.addEventListener("click",(()=>E(!0)))}))},a.addEventListener("click",(()=>{document.querySelectorAll(".train-card").forEach((e=>e.remove())),g(),e.value="",p(),E(!1)})),i.addEventListener("click",(()=>{document.querySelectorAll(".train-card").forEach((e=>e.remove())),g(),e.value="",p(),E(!1)})),e.value="";let v="true"===localStorage.getItem("darkMode");function N(e){document.body.classList.toggle("dark",e),r.textContent=e?"üåô":"‚òÄÔ∏è",localStorage.setItem("darkMode",e)}function f(e){n.innerHTML=`<div class="error-box">‚ùå ${e}</div>`}function g(){const e=n.querySelector(".error-box");e&&e.remove()}function y(){const e=document.cookie.match(/(?:^|; )lastSearches=([^;]+)/);return e?e[1].split(","):[]}function $(e){e=e.toUpperCase().replace(/^"(.*)"$/,"$1").trim();let t=y().filter((t=>t.toUpperCase()!==e));t.unshift(e),t.length>10&&t.pop(),document.cookie=`lastSearches=${t.join(",")}; path=/; max-age=31536000`}async function k(t=!1){let r=e.value.trim();const s=o.value;if(g(),!s&&!r)return f("[chooseError1]"),p(),void E(!1);if(!s)return f("[chooseError2]"),p(),void E(!1);if(!r)return f("[chooseError3]"),p(),void E(!1);g(),n.innerHTML="<p>[error3]</p>";try{const e=await async function(e){try{const t=await fetch(`https://panel.simrail.eu:8084/trains-open?serverCode=${e}`);if(!t.ok)throw new Error(`${t.status} ${t.statusText}`);const n=await t.json();return n?.data||[]}catch(e){return f(`[error6]${e.message}`),[]}}(s),n=function(e){return e.toUpperCase().split(/[,+]/).map((e=>e.trim())).filter((e=>e.length>0))}(r);if(0===n.length)return f("[chooseError4]"),p(),void E(!1);let o;if(o=r.includes("+")&&n.length>1?e.filter((e=>n.every((t=>L(e,t))))):e.filter((e=>n.some((t=>L(e,t))))),o.sort(((e,t)=>Number(e.TrainNoLocal)-Number(t.TrainNoLocal))),0===o.length)return f("[chooseError5]"),p(),void E(!1);if(function(e){g();const t=document.getElementById("results");if(!t)return void console.error("[error4]");if(0===e.length)return void f("[error5]");t.innerHTML="";const n=["EU07","EP07","EP08","EP09","E6ACTadb","E6ACTa","E186","ET22","ET25"],o=["EN76","EN96","EN57","EN71","ED250"],r={"EN57-038":"EN57-038","EN57-047":"EN57-038","EN57-206":"EN57-015","EN57-612":"EN57-015","EN57-614":"EN57-614","EN57-650":"EN57-015","EN57-919":"EN57-919","EN57-1000":"EN57-1000","EN57-1003":"EN57-614","EN57-1051":"EN57-009","EN57-1181":"EN57-015","EN57-1219":"EN57-1219","EN57-1316":"EN57-1219","EN57-1331":"EN57-015","EN57-1458":"EN57-1458","EN57-1567":"EN57-1567","EN57-1571":"EN57-1458","EN57-1752":"EN57-1567","EN57-1755":"EN57-1755","EN57-1796":"EN57-1000","EN57-1821":"EN57-1821","EN71-002":"EN57-015","EN71-004":"EN57-015","EN71-005":"EN57-1219","EN71-011":"EN57-009","EN71-015":"EN57-015","EU07-085":"EU07-005","11xa Bc9ou":"11xa_Bc9ou","111A_51 51 20-71 102":"111A_51_51_20-71_102","111A_51 51 20-70 829":"111A_51_51_20-70_829",a9mnouz_61511970234:"a9mnouz_61511970234",b11mnouz_61512170098:"b11mnouz_61512170098",b11mnouz_61512170064:"b11mnouz_61512170064"};e.forEach((e=>{const s=document.createElement("div");s.className="train-card";let c=e.Category||"";const a=e.Line?`${e.Line}`:"",i=e.TrainNoLocal||"",l=e.TrainName||"",d=e.StartStation||"?",u=e.EndStation||"?";let m=0,E=0,p=0;Array.isArray(e.Vehicles)&&e.Vehicles.forEach((e=>{let t=(e.includes("/")?e.split("/").pop():e).split("_")[0];n.some((e=>t.startsWith(e)))?m++:o.some((e=>t.startsWith(e)))?E++:p++}));const h=localStorage.getItem("lang")||"en",v=translations[h]?.compositionText||"Vlak slo≈æen√Ω z {text}.";function N(e,t,n){return 1===e?`1 ${t}`:`${e} ${n}`}function f(e,t,n){return 1===e?`1 ${t}`:`${e} ${n}`}function g(e,t="cs"){return"en"===t?N(e,"car","cars"):"pl"===t?f(e,"wagonu","wagon√≥w"):1===e?"1 vozu":`${e} voz≈Ø`}function y(e,t="cs"){return"en"===t?N(e,"locomotive","locomotives"):"pl"===t?f(e,"lokomotywy","lokomotyw"):1===e?"1 lokomotivy":`${e} lokomotiv`}let $="";if(E>0)$=function(e,t="cs"){return"en"===t?N(e,"unit","units"):"pl"===t?f(e,"zespo≈Çu","zespo≈Ç√≥w"):1===e?"1 jednotky":`${e} jednotek`}(E,h);else if(m>0&&0===p)$=y(m,h);else if(1===m)$=g(p,h);else{const e="pl"===h?"i":"a";$=`${y(m,h)} ${e} ${g(p,h)}`}const k=v.replace("{text}",$);if(s.innerHTML=`\n        <h2>${l} ‚Äì ${c}${a} (${i})</h2>\n        <p><strong>${d}</strong> ‚ûù <strong>${u}</strong></p>\n        <p>${k}</p>\n      `,Array.isArray(e.Vehicles)&&e.Vehicles.length>0){const t=document.createElement("div");t.className="vehicles-scroll-wrapper";const n=document.createElement("div");n.className="vehicles-container",e.Vehicles.forEach((e=>{let t=e.replace("/","-"),[o,s]=e.split("/"),c=s?s.split(" ")[0]:e;o&&(t=t||o),c&&(t=c||t);const a=c;let i,l=c;function d(e){return r.hasOwnProperty(e)?r[e]:e}if(l.includes("EN71")&&(o="EN71"),/^11xa\/80s\//.test(e))i="11xa_Bc9ou",l="11xa Bc9ou",o="(1980)";else if(r.hasOwnProperty(a))i=r[a];else if(i=c,c.includes(":")&&(c=c.split(":")[0],i=c,l=c),c.startsWith("ED250")){i="ED250";const e=c.match(/ED250-\d+/);e&&(l=e[0])}else{if(c.includes("_")&&(i=c.split("_")[0],l=i),c.includes("brazowy")&&(i=c.split(":")[0]),/^412W\//.test(e)){const t=e.match(/^412W\/412W_v\d+_(\d+)(?:-[\d]+)?(_b)?/);if(t){let e=t[1],n=t[2]||"";n=n.replace("_",""),i=d(`412W_${e}${n}`),l="412W"}else{const t=e.match(/412W\/([^:-]+)-/);t&&(i=d(t[1]),l="412W")}}if(/^11xa\//.test(e)){const t=e.match(/^11xa\/([^:-]+-[^:-]+)-/);t&&(i=t[1].replace(/ /g,"_"))}if(c.includes("406Ra")&&(i=d(c.split("-")[0])),/^441V\//.test(e)){const t=e.match(/441V\/([^:-]+)-/);t&&(i=d(t[1]),l="441V")}if(/^Z2\//.test(e)){const t=e.match(/Z2\/([^:-]+)-/);t&&(i=d(t[1]))}}let u="";if(e.includes("@")){const t=e.split("@")[1].split(" ")[0],n=translations[h]?.cargoNames?.[t];u=n?` / ${n}`:""}const m=o?o.replace(/([a-zA-Z]+)(\d+)/,((e,t,n)=>t+n)):"",E=l.charAt(0).toUpperCase()+l.slice(1),p=r.hasOwnProperty(a)?r[a]:E,v=document.createElement("div");v.className="vehicle",v.innerHTML=`\n            <img src="vehicles/${i}.png" title="${p}" />\n            <div class="vehicle-number">${E}</div>\n            <div class="vehicle-nickname">${m}${u}</div>\n          `,n.appendChild(v)})),t.appendChild(n),s.appendChild(t)}t.appendChild(s)}))}(o),!t)if(1===n.length){const e=n[0];/[A-Z]/.test(e)&&/[A-Z]/i.test(e.replace(/[0-9\s\-+,]/g,""))?$(`"${e.toUpperCase()}"`):$(e.toUpperCase())}else $(r.toUpperCase());E(!0),p()}catch(e){f(`[error1]${e.message}`),E(!1)}}function L(e,t){const n=t.trim().toUpperCase();if(function(e){if((e=e.trim()).includes("-")){const[t,n]=e.split("-").map(Number);return isNaN(t)||isNaN(n)||t>n?[]:Array.from({length:n-t+1},((e,n)=>String(t+n)))}return[e]}(n).includes(String(e.TrainNoLocal)))return!0;const o=e.TrainName.toUpperCase();return!!o.split(/[\s\-]+/).includes(n)||(!!o.includes(n)||!(!Array.isArray(e.Vehicles)||!e.Vehicles.some((e=>e.toUpperCase().includes(n)))))}N(v),r.addEventListener("click",(()=>{v=!v,N(v)})),localStorage.getItem("cookiesAccepted")||(s.classList.remove("hidden"),c.addEventListener("click",(()=>{s.classList.add("hidden"),localStorage.setItem("cookiesAccepted","true")}))),fetch("https://panel.simrail.eu:8084/servers-open").then((e=>e.json())).then((e=>{e.data.filter((e=>e.IsActive)).forEach((e=>{const t=document.createElement("option");t.value=e.ServerCode,t.textContent=e.ServerName,o.appendChild(t)})),o.value=localStorage.getItem("selectedServer")||""})).catch((e=>console.error("[error2]",e))),o.addEventListener("change",(()=>{localStorage.setItem("selectedServer",o.value)})),p()})),document.getElementById("noCookiesBtn").addEventListener("click",(e=>{e.preventDefault(),deleteAllCookies(),location.reload()}));